import{r as g,j as a,a as p}from"./jsx-runtime-6ad60c64.js";const ie=(e,t)=>{const r=new URL(`https://www.goodreads.com/review/list/${e.userId}`);return r.searchParams.set("shelf",e.shelf||"read"),r.searchParams.set("sort",e.sort||"date_read"),r.searchParams.set("order",e.order||"d"),r.searchParams.set("page",String(t)),e.search&&r.searchParams.set("search[query]",e.search),new URL(`https://cors.kylekarpack.workers.dev/corsproxy/?apiurl=${encodeURIComponent(r.toString())}`)},le=(e,t=150)=>{const s=new DOMParser().parseFromString(e,"text/html").querySelectorAll("tr"),o=Array.from(s);let i;return typeof t!="number"?i=parseInt(t)||100:i=t,o.map(n=>oe(n,i))},oe=(e,t)=>{var T,$,D,P,w,G,V,z,A,Z,R,E,j;const r=($=(T=e==null?void 0:e.querySelector("td.field.isbn .value"))==null?void 0:T.textContent)==null?void 0:$.trim(),l=(P=(D=e==null?void 0:e.querySelector("td.field.asin .value"))==null?void 0:D.textContent)==null?void 0:P.trim();let s=((w=e==null?void 0:e.querySelector("td.field.title a"))==null?void 0:w.getAttribute("title"))??"";const o=(V=(G=e==null?void 0:e.querySelector("td.field.author .value"))==null?void 0:G.textContent)==null?void 0:V.trim().replace(" *","").split(", ").reverse().join(" "),i=(A=(z=e==null?void 0:e.querySelector("td.field.cover img"))==null?void 0:z.getAttribute("src"))==null?void 0:A.replace(/\._(S[Y|X]\d+_?){1,2}_/i,`._SX${t*2}_`),n=(Z=e==null?void 0:e.querySelector("td.field.cover a"))==null?void 0:Z.getAttribute("href"),c=(R=e==null?void 0:e.querySelectorAll("td.field.rating .staticStars .p10"))==null?void 0:R.length,d=(E=e==null?void 0:e.querySelector("td.field.date_read .date_read_value"))==null?void 0:E.textContent,u=(j=e==null?void 0:e.querySelector("td.field.date_added span"))==null?void 0:j.textContent,m=d?new Date(d):void 0,h=u?new Date(u):void 0;let f="";const y=s.split(":");y.length>1&&(s=y[0],f=y[1]);const q=s.match(/\(.*\)/);if(q){const[U]=q;f=U.replace("(","").replace(")",""),s=s.replace(U,"")}return{id:`${r||l||window.crypto.randomUUID()}`,isbn:r,asin:l,title:s,subtitle:f,author:o,imageUrl:i,rating:c,dateRead:m,dateAdded:h,link:`https://www.goodreads.com/${n}`}},de=30,se="All",ce=async e=>{const t=await H(1,e),r=Math.min(e.limit??10,t.status.total),l=Math.ceil(r/de),s=[];for(let n=2;n<=l;n++)s.push(H(n,e));const o=await Promise.all(s);o.sort((n,c)=>n.status.end-c.status.end);let i=o.reduce((n,c)=>n.concat(c.books),t.books);if(e.filter&&(i=i.filter(e.filter)),e.limit&&(i=i.slice(0,e.limit)),e.groupBy){const n=i.reduce((d,u)=>{var h;const m=String((h=u.dateRead||u.dateAdded)==null?void 0:h.getFullYear());return d[m]=d[m]||[],d[m].push(u),d},{}),c=[];for(const d in n)c.push({title:d,books:n[d]});return c.sort((d,u)=>Number(u.title)-Number(d.title)),c}else return[{title:se,books:i}]},H=async(e,t)=>{const r=ie(t,e);r.searchParams.append("page",String(e));const l=await window.fetch(r.toString(),{headers:{accept:"text/javascript"}});if(l.status===204)return{books:[],status:{end:e*30,total:0}};const s=await l.text(),{html:o,status:i}=ue(s),n=`<table>${o}</table>`;return{books:le(n,t.width),status:i}},ue=e=>{var i,n;const[t,r]=e.split(`
`),l=t.replace('Element.insert("booksBody", ',"").replace(" });","}").replace("bottom",'"bottom"'),s=JSON.parse(l).bottom,o=r.match(/(?<end>\d*) of (?<total>\d*) loaded/);return{html:s,status:{end:parseInt(((i=o==null?void 0:o.groups)==null?void 0:i.end)??"0"),total:parseInt(((n=o==null?void 0:o.groups)==null?void 0:n.total)??"0")}}},pe=e=>{const{userId:t,limit:r,order:l,search:s,shelf:o,sort:i}=e,[n,c]=g.useState([]),[d,u]=g.useState(!1),[m,h]=g.useState(null),f=async()=>{u(!0),h(null);try{const y=await ce(e);c(y)}catch(y){h(y)}finally{u(!1)}};return g.useEffect(()=>{t&&f()},[t,r,l,s,o,i]),{books:n,loading:d,error:m}},me="_book_1pxem_1",he="_details_1pxem_5",fe="_title_1pxem_9",ge="_subtitle_1pxem_15",ye="_author_1pxem_19",v={book:me,details:he,title:fe,subtitle:ge,author:ye},S=()=>a("div",{children:p("svg",{xmlns:"http://www.w3.org/2000/svg",style:{width:"100%"},viewBox:"0 0 170 250",children:[a("path",{style:{fill:"#ffffff",stroke:"none"},d:"M0 0L0 240L170 240L170 0L0 0z"}),a("path",{style:{fill:"#000000",stroke:"none"},d:"M82 61L83 62L82 61z"}),a("path",{style:{fill:"#808080",stroke:"none"},d:"M93 145C79.6257 141.205 63.417 138.566 51.0401 132.235C46.9518 130.144 41.5316 121.554 47.3179 118.068C50.6475 116.062 56.6487 119.038 60 120L80 125.579C83.4433 126.56 87.3543 128.206 90.9961 127.812C95.0859 127.369 97.4951 123.882 100 120.999C105.227 114.984 110.546 109.055 115.729 103C121.144 96.673 126.701 90.4409 131.981 84C134.072 81.4479 137.039 77.7432 134.957 74.3032C133.56 71.995 130.402 71.472 128 70.885C122.364 69.5077 116.654 68.419 111 67.1188C104.688 65.6674 98.3344 64.3539 92 63C89.2014 62.4019 85.8624 61.1288 83 61.9159C76.588 63.679 71.3975 72.3808 67.0355 77C63.9636 80.253 61.0812 83.6855 58.0748 87C47.4655 98.6969 26.6977 117.282 38.9699 134.907C42.2427 139.607 47.7809 141.351 53 142.975C62.2818 145.863 71.6555 148.463 81 151.141C85.2587 152.362 91.5271 155.739 95.9105 153.731C99.4375 152.115 102.007 147.89 104.414 145C109.434 138.971 114.602 133.068 119.576 127C126.295 118.802 135.654 111.058 135.454 100C135.402 97.0889 136.725 92.9476 133.685 91.0471C129.481 88.4187 126.946 93.731 126.329 97.0008C122.619 116.665 101.124 127.263 93 145z"}),a("path",{style:{fill:"#000000",stroke:"none"},d:"M85 61L86 62L85 61M112 67L113 68L112 67M117 68L118 69L117 68M72 71L73 72L72 71z"}),a("path",{style:{fill:"#555555",stroke:"none"},d:"M80 78L81 79L80 78z"}),a("path",{style:{fill:"#ffffff",stroke:"none"},d:"M77 84C83.6869 85.3802 90.3853 87.037 97 88.7315C103.67 90.4403 109.474 92.3156 113 85C105.981 83.9673 98.9214 81.7562 92 80.1157C85.4991 78.5749 80.3963 76.9541 77 84z"}),a("path",{style:{fill:"#000000",stroke:"none"},d:"M110 89L111 90L110 89M54 91L55 92L54 91z"}),a("path",{style:{fill:"#aaaaaa",stroke:"none"},d:"M122 108L123 109L122 108z"}),a("path",{style:{fill:"#000000",stroke:"none"},d:"M121 109L122 110L121 109M37 112L38 113L37 112M116 115L117 116L116 115z"}),a("path",{style:{fill:"#555555",stroke:"none"},d:"M103 116L104 117L103 116M46 117L47 118L46 117M45 118L46 119L45 118z"}),a("path",{style:{fill:"#000000",stroke:"none"},d:"M124 120L125 121L124 120M69 122L70 123L69 122M37 132L38 133L37 132M50 132L51 133L50 132M42 138L43 139L42 138M109 138L110 139L109 138z"}),a("path",{style:{fill:"#555555",stroke:"none"},d:"M87 143L88 144L87 143z"}),a("path",{style:{fill:"#000000",stroke:"none"},d:"M99 150L100 151L99 150M82 151L83 152L82 151z"})]})});try{S.displayName="Placeholder",S.__docgenInfo={description:"",displayName:"Placeholder",props:{}}}catch{}const Le="_image_27awu_1",_e="_cover_27awu_13",F={image:Le,cover:_e},C=({book:e,options:t})=>{var u;const[r,l]=g.useState({error:!1}),[s,o]=g.useState(!1),i=g.useRef(null);g.useEffect(()=>{const m=new window.IntersectionObserver(h=>{const{isIntersecting:f}=h[0];f&&m.disconnect(),o(f)},{threshold:0});i!=null&&i.current&&m.observe(i.current)},[]);let{imageUrl:n}=e;n||(e.isbn?n=`https://images-na.ssl-images-amazon.com/images/P/${e.isbn}.01._SCLZZZZZZZ_.jpg`:e.asin&&(n=`https://images-na.ssl-images-amazon.com/images/P/${e.asin}.01._SCLZZZZZZZ_.jpg`));const c=()=>l({error:!0}),d=g.useMemo(()=>m=>{var f;let h="";return(f=t==null?void 0:t.displayOptions)!=null&&f.hideBackgroundImages||s&&(h=`url("${m}")`),{backgroundImage:h,opacity:s?1:0}},[n,s,(u=t==null?void 0:t.displayOptions)==null?void 0:u.hideBackgroundImages]);return a("div",{ref:i,className:`rgs-cover ${F.cover}`,style:d(n),children:r.error?a("div",{className:"rgs-placeholder","data-testid":"placeholder",children:a(S,{})}):a("div",{children:a("img",{alt:e.title,className:`rgs-image ${F.image}`,src:n,loading:"lazy",onError:c})})})};try{C.displayName="Cover",C.__docgenInfo={description:"",displayName:"Cover",props:{book:{defaultValue:null,description:"",name:"book",required:!0,type:{name:"Book"}},options:{defaultValue:null,description:"",name:"options",required:!1,type:{name:"Props"}}}}}catch{}const N=({stars:e})=>{if(e){const t=new Array(e).fill("â˜…");return a("div",{role:"presentation",children:t.map((r,l)=>a("span",{children:r},l))})}return null};try{N.displayName="Rating",N.__docgenInfo={description:"",displayName:"Rating",props:{stars:{defaultValue:null,description:"",name:"stars",required:!1,type:{name:"number"}}}}}catch{}const be=({book:e,options:t})=>{var s;const r=(s=t==null?void 0:t.displayOptions)==null?void 0:s.hideDetails;if(r===!0)return null;const l=o=>r===!1?!0:!(r!=null&&r[o]);return p("div",{className:`rgs-details ${v.details}`,children:[l("title")&&a("div",{className:`rgs-title ${v.title}`,children:e.title}),l("subtitle")&&e.subtitle?a("div",{className:`rgs-subtitle ${v.subtitle}`,children:e.subtitle}):null,l("author")&&a("div",{className:`rgs-author ${v.author}`,children:e.author}),l("rating")&&a(N,{stars:e.rating})]})},B=({book:e,options:t})=>e?p("div",{children:[a("div",{className:`rgs-book ${v.book}`,title:e.title,children:a("a",{href:e.link,target:"_blank",rel:"nofollow noreferrer",children:a(C,{book:e,options:t})})}),a(be,{book:e,options:t})]}):null;try{B.displayName="Book",B.__docgenInfo={description:"",displayName:"Book",props:{book:{defaultValue:null,description:"",name:"book",required:!0,type:{name:"Book"}},options:{defaultValue:null,description:"",name:"options",required:!1,type:{name:"Props"}}}}}catch{}const ve="_shelf_mh1qy_1",ke={shelf:ve},Me=e=>{var l,s,o,i,n;let{width:t}=e||{};typeof t=="number"&&(t=`${t}px`),t=t||"170px";const r=(l=e==null?void 0:e.displayOptions)!=null&&l.hideDetails?`calc(${t} / 8)`:`calc(${t} / 6)`;return{gridTemplateColumns:`repeat(auto-fill, minmax(${t}, 1fr))`,columnGap:((o=(s=e==null?void 0:e.displayOptions)==null?void 0:s.gridStyle)==null?void 0:o.columnGap)??r,rowGap:((n=(i=e==null?void 0:e.displayOptions)==null?void 0:i.gridStyle)==null?void 0:n.rowGap)??r}},x=({books:e,options:t})=>a("ul",{className:`rgs-shelf ${ke.shelf}`,style:Me(t),children:e.map(r=>a("li",{children:a(B,{book:r,options:t})},r.id))});try{x.displayName="BookList",x.__docgenInfo={description:"",displayName:"BookList",props:{books:{defaultValue:null,description:"",name:"books",required:!0,type:{name:"Book[]"}},options:{defaultValue:null,description:"",name:"options",required:!1,type:{name:"Props"}}}}}catch{}const Se="_groupTitle_1e2wf_1",Ce="_group_1e2wf_1",Y={groupTitle:Se,group:Ce},O=()=>a("div",{style:{textAlign:"center"},children:p("svg",{width:50,height:50,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid",children:[a("path",{d:"M20 25h60v50H20z",fill:"transparent",stroke:"#85a2b6"}),p("path",{d:"M50 25l9.421-3.43v56.86L50 75",fill:"transparent",stroke:"#85a2b6",children:[a("animate",{attributeName:"d",calcMode:"linear",values:"M50 25L80 25L80 75L50 75;M50 25L50 20L50 80L50 75;M50 25L80 25L80 75L50 75;M50 25L80 25L80 75L50 75",keyTimes:"0;0.5;0.501;1",dur:1.6,begin:"0s",repeatCount:"indefinite"}),a("animate",{attributeName:"opacity",calcMode:"linear",values:"1;1;0;0",keyTimes:"0;0.5;0.5001;1",dur:1.6,begin:"0s",repeatCount:"indefinite"})]}),p("path",{d:"M50 25h30v50H50",fill:"transparent",stroke:"#85a2b6",children:[a("animate",{attributeName:"d",calcMode:"linear",values:"M50 25L80 25L80 75L50 75;M50 25L50 20L50 80L50 75;M50 25L80 25L80 75L50 75;M50 25L80 25L80 75L50 75",keyTimes:"0;0.5;0.501;1",dur:1.6,begin:"-0.2656s",repeatCount:"indefinite"}),a("animate",{attributeName:"opacity",calcMode:"linear",values:"1;1;0;0",keyTimes:"0;0.5;0.5001;1",dur:1.6,begin:"-0.2656s",repeatCount:"indefinite"})]}),p("path",{d:"M50 25h30v50H50",fill:"transparent",stroke:"#85a2b6",children:[a("animate",{attributeName:"d",calcMode:"linear",values:"M50 25L80 25L80 75L50 75;M50 25L50 20L50 80L50 75;M50 25L80 25L80 75L50 75;M50 25L80 25L80 75L50 75",keyTimes:"0;0.5;0.501;1",dur:1.6,begin:"-0.528s",repeatCount:"indefinite"}),a("animate",{attributeName:"opacity",calcMode:"linear",values:"1;1;0;0",keyTimes:"0;0.5;0.5001;1",dur:1.6,begin:"-0.528s",repeatCount:"indefinite"})]}),p("path",{d:"M50 25l-10.379-3.27v56.54L50 75",fill:"transparent",stroke:"#85a2b6",children:[a("animate",{attributeName:"d",calcMode:"linear",values:"M50 25L20 25L20 75L50 75;M50 25L20 25L20 75L50 75;M50 25L50 20L50 80L50 75;M50 25L20 25L20 75L50 75",keyTimes:"0;0.499;0.5;1",dur:1.6,begin:"-0.528s",repeatCount:"indefinite"}),a("animate",{attributeName:"opacity",calcMode:"linear",values:"0;0;1;1",keyTimes:"0;0.4999;0.5;1",dur:1.6,begin:"-0.528s",repeatCount:"indefinite"})]}),p("path",{d:"M50 25l-.539-4.91v59.82L50 75",fill:"transparent",stroke:"#85a2b6",children:[a("animate",{attributeName:"d",calcMode:"linear",values:"M50 25L20 25L20 75L50 75;M50 25L20 25L20 75L50 75;M50 25L50 20L50 80L50 75;M50 25L20 25L20 75L50 75",keyTimes:"0;0.499;0.5;1",dur:1.6,begin:"-0.2656s",repeatCount:"indefinite"}),a("animate",{attributeName:"opacity",calcMode:"linear",values:"0;0;1;1",keyTimes:"0;0.4999;0.5;1",dur:1.6,begin:"-0.2656s",repeatCount:"indefinite"})]}),p("path",{d:"M50 25H20v50h30",fill:"transparent",stroke:"#85a2b6",children:[a("animate",{attributeName:"d",calcMode:"linear",values:"M50 25L20 25L20 75L50 75;M50 25L20 25L20 75L50 75;M50 25L50 20L50 80L50 75;M50 25L20 25L20 75L50 75",keyTimes:"0;0.499;0.5;1",dur:1.6,begin:"0s",repeatCount:"indefinite"}),a("animate",{attributeName:"opacity",calcMode:"linear",values:"0;0;1;1",keyTimes:"0;0.4999;0.5;1",dur:1.6,begin:"0s",repeatCount:"indefinite"})]})]})});try{O.displayName="Loader",O.__docgenInfo={description:"",displayName:"Loader",props:{}}}catch{}const I=e=>{const{books:t,loading:r,error:l}=pe(e);return p("div",{className:"rgs-shelf",children:[r?a(O,{}):a("div",{children:t.map(s=>p("div",{className:`rgs-group ${Y.group}`,children:[s.title!==se&&p("div",{className:`rgs-group-title ${Y.groupTitle}`,children:[s.title," ",p("small",{children:["(",s.books.length," ",s.books.length===1?"book":"books",")"]})]}),a(x,{books:s.books,options:e})]},s.title))}),l&&a("div",{children:"Sorry, we couldn't load books right now"})]})},ne=I;try{I.displayName="GoodreadsBookshelf",I.__docgenInfo={description:"Display a Goodreads bookshelf component",displayName:"GoodreadsBookshelf",props:{userId:{defaultValue:null,description:"The user ID for whom to fetch books",name:"userId",required:!0,type:{name:"string"}},shelf:{defaultValue:null,description:"The shelf from which to fetch books",name:"shelf",required:!1,type:{name:"string"}},width:{defaultValue:null,description:"Minimum width allowed for each book",name:"width",required:!1,type:{name:"string | number"}},sort:{defaultValue:null,description:"The field by which to sort the results returned",name:"sort",required:!1,type:{name:"enum",value:[{value:'"title"'},{value:'"author"'},{value:'"cover"'},{value:'"rating"'},{value:'"year_pub"'},{value:'"date_pub"'},{value:'"date_pub_edition"'},{value:'"date_started"'},{value:'"date_read"'},{value:'"date_updated"'},{value:'"date_added"'},{value:'"recommender"'},{value:'"avg_rating"'},{value:'"num_ratings"'},{value:'"review"'},{value:'"read_count"'},{value:'"votes"'},{value:'"random"'},{value:'"comments"'},{value:'"notes"'},{value:'"isbn"'},{value:'"isbn13"'},{value:'"asin"'},{value:'"num_pages"'},{value:'"format"'},{value:'"position"'},{value:'"shelves"'},{value:'"owned"'},{value:'"date_purchased"'},{value:'"purchase_location"'},{value:'"condition"'}]}},order:{defaultValue:null,description:"The direction in which to sort the results",name:"order",required:!1,type:{name:"enum",value:[{value:'"a"'},{value:'"d"'}]}},limit:{defaultValue:null,description:"The maximum number of books to be returned",name:"limit",required:!1,type:{name:"number"}},search:{defaultValue:null,description:"Optional search text",name:"search",required:!1,type:{name:"string"}},displayOptions:{defaultValue:null,description:"Shelf display options",name:"displayOptions",required:!1,type:{name:"DisplayOptions"}},filter:{defaultValue:null,description:"Filter book option",name:"filter",required:!1,type:{name:"((book: Book) => boolean)"}},groupBy:{defaultValue:null,description:"Group by option",name:"groupBy",required:!1,type:{name:"enum",value:[{value:'"year"'}]}}}}}catch{}const Ne=["title","author","cover","rating","year_pub","date_pub","date_pub_edition","date_started","date_read","date_updated","date_added","recommender","avg_rating","num_ratings","review","read_count","votes","random","comments","notes","isbn","isbn13","asin","num_pages","format","position","shelves","owned","date_purchased","purchase_location","condition"],Be=["read","currently-reading","to-read"],xe={title:"React Goodreads Shelf",component:ne,argTypes:{userId:{name:"User ID",control:{type:"text"}},width:{name:"Book Width",control:{type:"number",min:25,max:250}},hideDetails:{name:"Hide Details",control:"check",options:["title","subtitle","author","rating"]},hideBackgroundImages:{name:"Hide background images",control:"boolean"},limit:{name:"Number of Books",control:{type:"number",min:1,max:250}},shelf:{name:"Shelf Name",control:"select",options:Be},sort:{name:"Sort Field",control:"select",options:Ne},order:{name:"Order",control:"inline-radio",options:["a","d"]},search:{name:"Search Text",control:"text"},displayOptions:{table:{disable:!0}},filter:{table:{disable:!0}},groupBy:{table:{disable:!0}}}},Oe=e=>{const t={};for(let r of e||[])t[r]=!0;return t},Ie=e=>({hideDetails:Oe(e.hideDetails),hideBackgroundImages:e.hideBackgroundImages}),k=e=>{const t=Ie(e);return a(ne,{...e,displayOptions:t})},M=k.bind({});M.args={userId:"63515611",width:100,limit:12,shelf:"read",sort:"date_read",order:"d",search:""};const L=k.bind({});L.args={...M.args,hideDetails:["title","subtitle","author","rating"],limit:20};const _=k.bind({});_.args={...M.args,hideDetails:["rating"],width:130};const b=k.bind({});b.args={...M.args,width:130,groupBy:"year",limit:100};var J,W,X;L.parameters={...L.parameters,docs:{...(J=L.parameters)==null?void 0:J.docs,source:{originalSource:`args => {
  const displayOptions = getDisplayOptions(args);
  return <GoodreadsBookshelf {...args} displayOptions={displayOptions} />;
}`,...(X=(W=L.parameters)==null?void 0:W.docs)==null?void 0:X.source}}};var K,Q,ee;_.parameters={..._.parameters,docs:{...(K=_.parameters)==null?void 0:K.docs,source:{originalSource:`args => {
  const displayOptions = getDisplayOptions(args);
  return <GoodreadsBookshelf {...args} displayOptions={displayOptions} />;
}`,...(ee=(Q=_.parameters)==null?void 0:Q.docs)==null?void 0:ee.source}}};var te,ae,re;b.parameters={...b.parameters,docs:{...(te=b.parameters)==null?void 0:te.docs,source:{originalSource:`args => {
  const displayOptions = getDisplayOptions(args);
  return <GoodreadsBookshelf {...args} displayOptions={displayOptions} />;
}`,...(re=(ae=b.parameters)==null?void 0:ae.docs)==null?void 0:re.source}}};const qe=["MinimalShelf","StandardShelf","GroupedShelf"],$e=Object.freeze(Object.defineProperty({__proto__:null,GroupedShelf:b,MinimalShelf:L,StandardShelf:_,__namedExportsOrder:qe,default:xe},Symbol.toStringTag,{value:"Module"}));export{$e as G,L as M};
//# sourceMappingURL=0-GoodreadsBookshelf.stories-affc22c2.js.map
